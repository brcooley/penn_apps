<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- <meta name="author" content="Brett Cooley" /> -->
	<title>Facation</title>
	<link rel="stylesheet" href="/css/a.css" />
	<script src="http://code.jquery.com/jquery-latest.js"></script>
	<script src="/js/spin.min.js"></script>
</head>
<body>
	<script>
		function randInt(min, max) {
 			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		function add_content (data) {

			rand_photo = data.photos[randInt(0,data.photos.length-1)];

			$('.location').html(data.location);
			$('.trip-length').html(data.length);
			$('.loc-img').html('<img src=' + rand_photo + ' />');
			window.localStorage['bg-img'] = rand_photo;
			if (data.hotels) {
				$('.hotel').html(data.hotels['name']);
			}
		}

		function request_itinerary() {
			$.ajax({
				type: 'POST',
				url: 'http://pennapps.cloudapp.net:8080/vacationinfo',
				data: {'access_token': window.localStorage['auth_tok']},
				success: function(response) {
					console.log(response);
					$(".load").fadeOut(500, function() {
						spinner.stop();
						add_content(response);
						$(".delay").fadeIn(500);
					});
				},
				error: function(response, text_status) {
					console.log(response);
					$(".load").fadeOut(500, function() {
						spinner.stop();
						$(".error").fadeIn(500);
					});
				},
				dataType: 'json'
			});
		}

		// Start actual execution here
		request_itinerary();

		$(window).load(function() {
			var opts = {
			    lines: 9, // The number of lines to draw
			    length: 2, // The length of each line
			    width: 15, // The line thickness
			    radius: 20, // The radius of the inner circle
			    corners: 0.95, // Corner roundness (0..1)
			    rotate: 24, // The rotation offset
			    color: '#ddd', // #rgb or #rrggbb
			    speed: 0.9, // Rounds per second
			    trail: 49, // Afterglow percentage
			    shadow: false, // Whether to render a shadow
			    hwaccel: true, // Whether to use hardware acceleration
			    className: 'spinner', // The CSS class to assign to the spinner
			    // zIndex: 2e9, // The z-index (defaults to 2000000000)
			    top: '50%', // Top position relative to parent in px
			    left: 'auto' // Left position relative to parent in px
			};
			var target = document.getElementById('loading');
			spinner = new Spinner(opts).spin(target);

			$('#book-btn').click(function() {
				// tell server to confirm registration
				window.location.assign('/thanks');
			});

			$('.retry').click(function() {
				// send another request to server
				$('.delay').fadeOut(500);
				$('.error').fadeOut(500);
				$('.spinner').fadeIn(500);
				spinner.spin();
				request_itinerary();
			});
		});
	</script>
	<div id="wrapper">
		<header>
			<h1><a href="/">Facation</a></h1>
			<h5 class="load">Generating your amazing vacation!</h5>
		</header>
		<section>
			<div id="loading" class="load"></div>
			<div class="delay">
				<section id="trip-info">
					<p>For your amazing Facation, you will be flying to fabulous <span class="location"></span> for a <span class="trip-length"></span>-day facation!</p> <div class="loc-img"></div>
					<p>You will be staying in the glamorous <span class="hotel"></span>, 
				</section>
				<button id="book-btn">Book my Facation!</button><button class="retry" id="retry-btn">Not awesome enough, give me another</button>
			</div>
			<div class="error">
				<p>You don't really want to go on facation, do you? If you did, our server wouldn't have given you an error.</p>
				<button class="retry">I'm sorry, I really do want a facation!</button>
			</div>
		</section>
		<footer>
			Using the Facebook API, Masherly (Hotwire), Azure, NYTimes, and more!
		</footer>
	</div>
</body>
</html>
